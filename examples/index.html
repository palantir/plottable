---
layout: example
---
<section id="section-example-1">
  <div class="container">
    <div class="row">

      <div class="col-md-3">
        <h3>
          <span class="badge">Example</span><br>
          Plottable Commits and Contributors vs Time
        </h3>
        <p>This Plottable chart displays large commits to Plottable over time, with the y-axis showing time of day and the x-axis showing date. The commits are color-coded based on contributor.</p>
        <p><a id="button-show-source-example-1-source" href="#example-1-source" class="button button-small">Show Source</a></p>
      </div>

      <div id="example-chart-1-container" class="col-md-8 col-md-offset-1">
        <div id="example-chart-1"></div>
      </div>

    </div>

    <div id="example-chart-1-source-wrapper" class="row">
      <div id="example-chart-1-source" style="display: none;" class="col-md-10 col-md-offset-1">
{% highlight javascript %}
function makeChart(commitData) {
    var xScale = new Plottable.Scale.Time();
    var yScale = new Plottable.Scale.Linear();
    var colorScale = new Plottable.Scale.Color("20")
        .domain(["Daniel Mane", "Justin Lan", "Ashwin Ramaswamy", "Bill Dwyer", "crmorford", "Brian Malehorn", "lewin"  , "other"])
        .range(["#ff7f0e"     , "#1f77b4"   , "#2ca02c"         , "#d62728"   , "#9467bd"  , "#8c564b"       , "#e377c2", "#000"]);

    var xAxis = new Plottable.Axis.Time(xScale, "bottom");
    var yAxis = new Plottable.Axis.Numeric(yScale, "left", hourFormatter);

    var scatter = new Plottable.Plot.Scatter(commitData, xScale, yScale)
                          .project("x", "parsedDate", xScale)
                          .project("y", hourAccessor, yScale)
                          .project("fill", "authorName", colorScale)
                          .project("r", 5)
                          .project("opacity", 0.4 );

    var gridlines = new Plottable.Component.Gridlines(xScale, yScale);
    var legend = new Plottable.Component.Legend(colorScale);
    var center = gridlines.merge(scatter).merge(legend);
    new Plottable.Template.StandardChart().center(center).xAxis(xAxis).yAxis(yAxis).renderTo("svg");
    new Plottable.Interaction.PanZoom(scatter, xScale, new Plottable.Scale.Linear()).registerWithComponent();
  }


  function hourAccessor(d) {
    var date = d.parsedDate;
    var hour =  date.getHours() + date.getMinutes() / 60;
    hour = hour < 5 ? hour + 24 : hour;
    return hour;
  }

  function dayAccessor(d) {
    var date = d.parsedDate;
    var msOffset = date.getMilliseconds() + 1000 * (date.getSeconds() + 60 * (date.getMinutes() + 60 * date.getHours()));
    return new Date(date - msOffset - 1000 * 60 * 60 * 12);
  }

  function hourFormatter(hour) {
    if (hour < 12) {
      return hour + "AM";
    } else if (hour === 12) {
      return "12PM";
    } else if (hour < 24) {
      return (hour - 12) + "PM";
    } else if (hour == 24) {
      return "12AM";
    } else {
      return (hour - 24) + "AM";
    }
  }

{% endhighlight %}
      </div>
    </div>
  </div>
</section>

<script id="example-1-source">
  function makeChart(commitData) {
    var xScale = new Plottable.Scale.Time();
    var yScale = new Plottable.Scale.Linear();
    var colorScale = new Plottable.Scale.Color("20")
        .domain(["Daniel Mane", "Justin Lan", "Ashwin Ramaswamy", "Bill Dwyer", "crmorford", "Brian Malehorn", "lewin"  , "other"])
        .range(["#ff7f0e"     , "#1f77b4"   , "#2ca02c"         , "#d62728"   , "#9467bd"  , "#8c564b"       , "#e377c2", "#000"]);

    var xAxis = new Plottable.Axis.Time(xScale, "bottom");
    var yAxis = new Plottable.Axis.Numeric(yScale, "left", hourFormatter);

    var scatter = new Plottable.Plot.Scatter(commitData, xScale, yScale)
                          .project("x", "parsedDate", xScale)
                          .project("y", hourAccessor, yScale)
                          .project("fill", "authorName", colorScale)
                          .project("r", 5)
                          .project("opacity", 0.4 );

    var gridlines = new Plottable.Component.Gridlines(xScale, yScale);
    var legend = new Plottable.Component.Legend(colorScale);
    var center = gridlines.merge(scatter).merge(legend);
    new Plottable.Template.StandardChart().center(center).xAxis(xAxis).yAxis(yAxis).renderTo("svg");
    new Plottable.Interaction.PanZoom(scatter, xScale, new Plottable.Scale.Linear()).registerWithComponent();
  }


  function hourAccessor(d) {
    var date = d.parsedDate;
    var hour =  date.getHours() + date.getMinutes() / 60;
    hour = hour < 5 ? hour + 24 : hour;
    return hour;
  }

  function dayAccessor(d) {
    var date = d.parsedDate;
    var msOffset = date.getMilliseconds() + 1000 * (date.getSeconds() + 60 * (date.getMinutes() + 60 * date.getHours()));
    return new Date(date - msOffset - 1000 * 60 * 60 * 12);
  }

  function hourFormatter(hour) {
    if (hour < 12) {
      return hour + "AM";
    } else if (hour === 12) {
      return "12PM";
    } else if (hour < 24) {
      return (hour - 12) + "PM";
    } else if (hour == 24) {
      return "12AM";
    } else {
      return (hour - 24) + "AM";
    }
  }


    window.onload = function() {
        d3.json("data/src-aggregated-commits.json", function(data) {
            var authors = ["Daniel Mane", "Justin Lan", "Ashwin Ramaswamy", "Bill Dwyer", "crmorford", "Brian Malehorn", "lewin"];
            data.forEach(function(d) {
              d.parsedDate = new Date(d.authorDate.seconds * 1000);
              a = d.authorName;
              d.authorName = authors.indexOf(a) !== -1 ? a : "other";
            });
            data = data.filter(function(d) {return d.additions > 20});
            var svg = d3.select("#example-chart-1").append("svg").attr("width", "100%").attr("height", 600);
            makeChart(data);
        });
    }

</script>

<script>
  $(function() {
    $('a#button-show-source-example-1-source').on('click', function(event) {
      var $this = $(this);
      if ($this.data('showing-source')) {
        $this.data('showing-source', false);
        $this.text('Show Source');
      } else {
        $this.data('showing-source', true);
        $this.text('Hide Source');
      }

      var $source = $('#example-chart-1-source').show();
      if ($this.data('showing-source')) {
        if (!$source.length) {
          $source = $("<div/>").attr('id', 'example-chart-1-source').html('<pre>' + $('#example-1-source').html() + '</pre>');
        }
        $('#example-chart-1-source-wrapper').append($source);
        $('html, body').animate({ scrollTop: $source.offset().top });
      } else {
        $source.hide();
      }

      event.preventDefault();
    });
  });
</script>
