<!DOCTYPE html>
<html>
  <head>
    <meta name="google" value="notranslate">
    <title>Plottable.js Tests</title>
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css">
    <link href="../plottable.css" type="text/css" rel="stylesheet" />
    <link href="tests.css" type="text/css" rel="stylesheet" />

    <script>
      window.PlottableTestCode = true;
    </script>
    <script src="../node_modules/d3/build/d3.js" charset="utf-8"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <!-- sinon imports -->
    <script src="../node_modules/sinon/lib/sinon.js"></script>
    <script src="../node_modules/sinon/lib/sinon/util/core.js"></script>
    <script src="../node_modules/sinon/lib/sinon/call.js"></script>
    <script src="../node_modules/sinon/lib/sinon/extend.js"></script>
    <script src="../node_modules/sinon/lib/sinon/times_in_words.js"></script>
    <script src="../node_modules/sinon/lib/sinon/format.js"></script>
    <script src="../node_modules/sinon/lib/sinon/spy.js"></script>
    <script src="../node_modules/sinon/lib/sinon/stub.js"></script>
    <!--  -->
    <script>
      mocha.setup({
        globals: ["LiveReload", "Pixel_CloseTo_Requirement"],
        ui: "bdd"
      }).timeout(1500);
    </script>

    <script src="../test/tests.js"></script>
    <script>
        if (window.PHANTOMJS) {
            blanket.options("reporter", "../node_modules/grunt-blanket-mocha/support/grunt-reporter.js");
        }
    </script>
  </head>

  <body>
    <div id="mocha"></div>
    <script>
      // mocha.checkLeaks();
    onload=function() {
      var runner;
      if (window.mochaPhantomJS) {
        runner = mochaPhantomJS.run();
      } else {
        runner = mocha.run();
      }
      var failedTests = [];
        runner.on('end', function(){
          window.mochaResults = runner.stats;
          window.mochaResults.reports = failedTests;
        });

        runner.on('fail', logFailure);

        function logFailure(test, err){

          var flattenTitles = function(test){
            var titles = [];
            while (test.parent.title){
              titles.push(test.parent.title);
              test = test.parent;
            }
            return titles.reverse();
          };

          failedTests.push({name: test.title, result: false, message: err.message, stack: err.stack, titles: flattenTitles(test) });
        };
      }
    </script>
  </body>
</html>
